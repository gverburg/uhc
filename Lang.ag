{
import UU.Pretty
import Data.List

import Debug.Trace

data Direction 
  = In 
  | Out 
  | InOut
  deriving (Show)
}

-- INTERFACE SPECIFICATION

TYPE Layers          = [Layer]
TYPE Interfaces      = [Interface]
TYPE Parameters      = [Parameter]
TYPE Rules           = [Rule]
TYPE Judgments       = [Judgment]

DATA Layer
  |  RawLayer          name       : {String}
                       parent     : {Maybe String}
                       interfaces : Interfaces
  |  Layer             name       : {String}
                       parent     : {Maybe Layer}
                       interfaces : Interfaces

DATA Interface
  |  Interface         name       : {String}
                       node       : {Maybe String}
                       params     : Parameters
                       uses       : Parameters
                       pattern    : {String}

DATA Parameter
  |  Parameter         name       : {String}
                       direction  : {Direction}
                       type       : {String}
                       visible    : {Bool}
                       directives : {[String]}


-- IMPLEMENTATION STRUCTURE

DATA Implementation
  | RawImplementation     layer      : {String}
                          rules      : Rules
  | Implementation        layer      : Layer
                          rules      : Rules

DATA Rule
  | RawRule           name           : {String}
                      interface      : {String}
                      preconditions  : Judgments
                      postconditions : Judgments
  | Rule              name           : {String}
                      interface      : Interface
                      preconditions  : Judgments
                      postconditions : Judgments

DATA Judgment
  | RawJudgment       name           : {String}
                      interface      : {String}
                      body           : {String}
                      defs           : {[(String,String)]}
  | Judgment          name           : {String}
                      interface      : Interface
                      body           : {String}
                      defs           : {[(String,String)]}                      

DERIVING Layer Interface Parameter Implementation Rule Judgment : Show 

INCLUDE "PrettyHaskell.ag"