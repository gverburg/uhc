% $Id$

%%[0
%include lhs2TeX.fmt
%include afp.fmt
%%]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Pretty printing of internal AST structure
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%[1 hs
ppNest :: PP a => [a] -> PP_DocL -> PP_DocL -> PP_Doc
ppNest nms attrs ps = ppNestInfo defaultEHCOpts nms attrs ps []

ppNestInfo :: PP a => EHCOpts -> [a] -> PP_DocL -> PP_DocL -> AssocL String PP_Doc -> PP_Doc
ppNestInfo opts nms attrs ps infos
  = ppListSep "" "" "_" nms
    >#< (   (if null attrs then empty else ppSpaced attrs)
        >-< (if ehcoptDebug opts then vlist (map (\(i,p) -> pp i >|< ":" >#< p) infos) else empty)
        )
    >-< indent 2 (vlist ps)

ppNm :: HsName -> PP_Doc
ppNm = text . show . show

mkInfo1 :: String -> PP_Doc -> (String,PP_Doc)
mkInfo1 = (,)
%%]

%%[1
ATTR AllNT AGItf [ | | ppAST USE {>-<} {empty} : PP_Doc ]

SEM AGItf
  | AGItf       lhs     .  ppAST    =   ppNestInfo @lhs.opts ["AGItf","AGItf"] [] [@expr.ppAST] (@info ++ @info2 ++ @info3 ++ @info_4_2)
                loc     .  info     =   []
                        .  info2    =   []
                        .  info3    =   []
                        .  info_4_2 =   []

SEM Decl
  | Val         lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Decl","Val"] [] [@patExpr.ppAST,@expr.ppAST] @info
                loc     .  info     =   [ mkInfo1 "lhs.tySigGam" (ppGam @lhs.tySigGam)
                                        ]
  | TySig       lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Decl","TySig"] [ppNm @nm] [@tyExpr.ppAST] @info
                loc     .  info     =   [ mkInfo1 "tyExpr.ty" (ppTy @tyExpr.ty)
                                        , mkInfo1 "gamSigTy" (ppTy @gamSigTy)
                                        ]

SEM Expr
  | IConst      lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","IConst"] [@pp] [] (@info ++ @info2)
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy @lhs.knTy)
                                        , mkInfo1 "ty" (ppTy @ty)
                                        ]
                        .  info2    =   []
  | CConst      lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","CConst"] [@pp] [] @info
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy @lhs.knTy)
                                        , mkInfo1 "ty" (ppTy @ty)
                                        ]
  | Var         lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","Var"] [ppNm @nm] [] (@info ++ @info2 ++ @info3 ++ @info_4_2)
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy @lhs.knTy)
                                        , mkInfo1 "ty" (ppTy @ty)
                                        ]
                        .  info2    =   []
                        .  info3    =   []
                        .  info_4_2 =   []
  | Con         lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","Con"] [ppNm @nm] [] (@info ++ @info2)
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy @lhs.knTy)
                                        , mkInfo1 "ty" (ppTy @ty)
                                        ]
                        .  info2    =   []
  | Let         lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","Let"] [] [@decls.ppAST,@body.ppAST] (@info ++ @info2 ++ @info3 ++ @info4 ++ @info_4_2)
                loc     .  info     =   []
                        .  info2    =   []
                        .  info3    =   []
                        .  info4    =   []
                        .  info_4_2 =   []
  | App         lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","App"] [] [@func.ppAST,@arg.ppAST] (@info ++ @info2 ++ @info_4_2)
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy @lhs.knTy)
                                        ]
                        .  info2    =   []
                        .  info_4_2 =   []
  | Parens      lhs     .  ppAST    =   ppNest ["Expr","Parens"] [] [@expr.ppAST]
  | AppTop      lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","AppTop"] [] [@expr.ppAST] (@info ++ @info2 ++ @info9)
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy @lhs.knTy)
                                        , mkInfo1 "expr.ty" (ppTy @expr.ty)
                                        ]
                        .  info2    =   []
                        .  info9    =   []
  | Lam         lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","Lam"] [] [@arg.ppAST,@body.ppAST] (@info ++ @info2 ++ @info3 ++ @info_4_2)
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy @lhs.knTy)
                                        , mkInfo1 "arg.valGam" (ppGam @arg.valGam)
                                        ]
                        .  info2    =   []
                        .  info3    =   []
                        .  info_4_2 =   []

SEM PatExpr
  | IConst      lhs     .  ppAST    =   ppNest ["PatExpr","IConst"] [@pp] []
  | CConst      lhs     .  ppAST    =   ppNest ["PatExpr","CConst"] [@pp] []
  | Var         lhs     .  ppAST    =   ppNestInfo @lhs.opts ["PatExpr","Var"] [ppNm @nm] [] @info
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy @lhs.knTy)
                                        , mkInfo1 "ty" (ppTy @ty)
                                        ]
  | VarAs       lhs     .  ppAST    =   ppNest ["PatExpr","VarAs"] [ppNm @nm] [@patExpr.ppAST]
  | Con         lhs     .  ppAST    =   ppNestInfo @lhs.opts ["PatExpr","Con"] [ppNm @nm] [] (@info ++ @info2)
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy @lhs.knTy)
                                        ]
                        .  info2    =   []
  | App         lhs     .  ppAST    =   ppNestInfo @lhs.opts ["PatExpr","App"] [] [@func.ppAST,@arg.ppAST] @info
                loc     .  info     =   []
  | Parens      lhs     .  ppAST    =   ppNest ["PatExpr","Parens"] [] [@patExpr.ppAST]
  | AppTop      lhs     .  ppAST    =   ppNestInfo @lhs.opts ["PatExpr","AppTop"] [] [@patExpr.ppAST] (@info ++ @info2)
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy @lhs.knTy)
                                        ]
                        .  info2    =   []
  
SEM TyExpr
  | Con         lhs     .  ppAST    =   ppNest ["TyExpr","Con"] [ppNm @nm] []
  | App         lhs     .  ppAST    =   ppNestInfo @lhs.opts ["TyExpr","App"] [] [@func.ppAST,@arg.ppAST] @info
                loc     .  info     =   []
  | Parens      lhs     .  ppAST    =   ppNest ["TyExpr","Parens"] [] [@tyExpr.ppAST]
  | AppTop      lhs     .  ppAST    =   ppNestInfo @lhs.opts ["TyExpr","AppTop"] [] [@tyExpr.ppAST] @info
                loc     .  info     =   [ mkInfo1 "appFunNm" (ppNm @tyExpr.appFunNm)
                                        ]

SEM Decls
  | Nil         lhs     .  ppAST    =   ppNest ["Decls","Nil"] [] []
  | Cons        lhs     .  ppAST    =   ppNest ["Decls","Cons"] [] [@hd.ppAST,@tl.ppAST]
%%]

%%[2
SEM Decl
  | Val         loc     .  info     :=  [ mkInfo1 "lhs.tySigGam" (ppGam @lhs.tySigGam)
                                        , mkInfo1 "sigTy" (ppTy @sigTy)
                                        , mkInfo1 "patExpr.ty" (ppTy @patExpr.ty)
                                        , mkInfo1 "expr.ty" (ppTy @expr.ty)
                                        , mkInfo1 "expr.tyCnstr" (ppCnstrV @expr.tyCnstr)
                                        ]

SEM Expr
  | IConst      loc     .  info2    :=  [ mkInfo1 "foCnstr fo" (pp (foCnstr @fo))
                                        ]
  | Var         loc     .  info2    :=  [ mkInfo1 "knTy+lhs.cnstr" (ppTy (@lhs.tyCnstr |=> @lhs.knTy))
                                        , mkInfo1 "fTy" (ppTy @fTy)
                                        , mkInfo1 "foCnstr fo" (pp (foCnstr @fo))
                                        ]
  | App         loc     .  info     :=  [ mkInfo1 "knTy+lhs.cnstr" (ppTy (@lhs.tyCnstr |=> @lhs.knTy))
                                        , mkInfo1 "func.ty" (ppTy @func.ty)
                                        , mkInfo1 "ty" (ppTy @ty)
                                        ]
  | AppTop      loc     .  info2    :=  [ mkInfo1 "expr.tyCnstr" (pp (@expr.tyCnstr))
                                        ]
  | Lam         loc     .  info2    :=  [ mkInfo1 "knTy" (ppTy (@lhs.tyCnstr |=> @lhs.knTy))
                                        , mkInfo1 "funTy" (ppTy @funTy)
                                        , mkInfo1 "foTy @foKnFun" (ppTy (foTy @foKnFun))
                                        , mkInfo1 "foCnstr @foKnFun" (pp (foCnstr @foKnFun))
                                        , mkInfo1 "ty" (ppTy @ty)
                                        , mkInfo1 "body.tyCnstr" (pp @body.tyCnstr)
                                        , mkInfo1 "lhs.finTyCnstr" (pp @lhs.finTyCnstr)
                                        ]
  | Let         loc     .  info     :=  [ mkInfo1 "decls.gathTySigGam" (ppGam @decls.gathTySigGam)
                                        , mkInfo1 "lValGam" (ppGam @lValGam)
                                        , mkInfo1 "lValGam+decls.tyCnstr" (ppGam (@decls.tyCnstr |=> @lValGam))
                                        , mkInfo1 "decls.tyCnstr" (ppCnstrV @decls.tyCnstr)
                                        ]

SEM PatExpr
  | AppTop      loc     .  info2    :=  [ mkInfo1 "patFunTy" (ppTy @patFunTy)
                                        , mkInfo1 "patExpr.ty" (ppTy @patExpr.ty)
                                        ]
  | Con         loc     .  info2    :=  [ mkInfo1 "patFunTy" (ppTy @patFunTy)
                                        , mkInfo1 "ty" (ppTy @ty)
                                        ]
%%]

%%[3
SEM TyExpr
  | Var         lhs     .  ppAST    =   ppNestInfo @lhs.opts ["TyExpr","Var"] [ppNm @nm] [] @info
                loc     .  info     =   []

SEM Expr
  | Let         loc     .  info2    :=  [ mkInfo1 "lSubsValGam" (ppGam @lSubsValGam)
                                        ]
%%]

%%[4
SEM Expr
  | TypeAs      lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","TypeAs"] [] [@expr.ppAST,@tyExpr.ppAST] @info
                loc     .  info     =   [ mkInfo1 "asTy" (ppTy @asTy)
                                        ]
  | Var         loc     .  info3    :=  [ mkInfo1 "lhs.fiOpts" (pp . show $ @lhs.fiOpts)
                                        ]
  | Con         loc     .  info2    :=  [ mkInfo1 "fTy" (ppTy @fTy)
                                        , mkInfo1 "foCnstr" (pp (foCnstr @fo))
                                        ]

SEM PatExpr
  | TypeAs      lhs     .  ppAST    =   ppNestInfo @lhs.opts ["PatExpr","TypeAs"] [] [@patExpr.ppAST,@tyExpr.ppAST] @info
                loc     .  info     =   [ mkInfo1 "asTy" (ppTy @asTy)
                                        , mkInfo1 "tyExpr.tyGam" (ppGam @tyExpr.tyGam)
                                        ]

SEM TyExpr
  | Quant       lhs     .  ppAST    =   ppNest ["TyExpr","Quant"] [text (showTyQu @qu),ppNm @tyVar] [@tyExpr.ppAST]
%%]

%%[4_2
SEM AGItf
  | AGItf       loc     .  info_4_2 :=  [ mkInfo1 "expr.imprTyCnstr" (ppCnstrV @expr.imprTyCnstr)
                                        , mkInfo1 "exprTyCnstr" (ppCnstrV @exprTyCnstr)
                                        ]

SEM Expr
  | Var         loc     .  info_4_2 :=  [ mkInfo1 "imprTy" (ppTy @imprTy)
                                        ]
  | Let         loc     .  info_4_2 :=  [ mkInfo1 "lExplTyCnstr" (ppCnstrV @lExplTyCnstr)
                                        , mkInfo1 "lQuTyCnstr" (ppCnstrV @lQuTyCnstr)
                                        ]
  | App         loc     .  info_4_2 :=  [ mkInfo1 "foTy imprFO1 (arg)" (ppTy (foTy @imprFO1))
                                        , mkInfo1 "foTy imprFO2 (fun)" (ppTy (foTy @imprFO2))
                                        , mkInfo1 "imprTy" (ppTy @imprTy)
                                        ]
  | Lam         loc     .  info_4_2 :=  [ mkInfo1 "lArgElimValGam" (ppGam @lArgElimValGam)
                                        , mkInfo1 "lhs.imprTyCnstr" (ppCnstrV @lhs.imprTyCnstr)
                                        , mkInfo1 "body.imprTyCnstr" (ppCnstrV @body.imprTyCnstr)
                                        , mkInfo1 "elimImprTyCnstr" (ppCnstrV @elimImprTyCnstr)
                                        , mkInfo1 "arg.tyCnstr" (ppCnstrV @arg.tyCnstr)
                                        , mkInfo1 "lhs.tyCnstr" (ppCnstrV @lhs.tyCnstr)
                                        ]
%%]

%%[5
SEM Decl
  | Data        lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Decl","Data"] [ppNm @tyNm] [@tyVars.ppAST,@constrs.ppAST] @info
                loc     .  info     =   []

SEM Expr
  | Case        lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","Case"] [] [@expr.ppAST,@alts.ppAST] @info
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy (@lhs.tyCnstr |=> @lhs.knTy))
                                        ]

SEM CaseAlt
  | Pat         lhs     .  ppAST    =   ppNest ["CaseAlt","Pat"] [] [@patExpr.ppAST,@expr.ppAST]

SEM CaseAlts
  | Nil         lhs     .  ppAST    =   ppNestInfo @lhs.opts  ["CaseAlts","Nil"] [] [] @info
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy (@lhs.tyCnstr |=> @lhs.knTy))
                                        ]
  | Cons        lhs     .  ppAST    =   ppNestInfo @lhs.opts ["CaseAlts","Cons"] [] [@hd.ppAST,@tl.ppAST] @info
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy (@lhs.tyCnstr |=> @lhs.knTy))
                                        ]

SEM TyExprs
  | Nil         lhs     .  ppAST    =   ppNest ["TyExprs","Nil"] [] []
  | Cons        lhs     .  ppAST    =   ppNest ["TyExprs","Cons"] [] [@hd.ppAST,@tl.ppAST]

SEM TyVar
  | Var         lhs     .  ppAST    =   ppNestInfo @lhs.opts ["TyVar","Var"] [ppNm @nm] [] @info
                loc     .  info     =   []

SEM TyVars
  | Nil         lhs     .  ppAST    =   ppNest ["TyVars","Nil"] [] []
  | Cons        lhs     .  ppAST    =   ppNest ["TyVars","Cons"] [] [@hd.ppAST,@tl.ppAST]

SEM DataConstr
  | Constr      loc     .  ppAST    =   ppNest ["DataConstr","Constr"] [ppNm @conNm] [@fields.ppAST]

SEM DataConstrs
  | Nil         lhs     .  ppAST    =   ppNest ["DataConstrs","Nil"] [] []
  | Cons        lhs     .  ppAST    =   ppNest ["DataConstrs","Cons"] [] [@hd.ppAST,@tl.ppAST]
%%]

%%[6
SEM TyVar
  | Var         loc     .  info     :=  [ mkInfo1 "tgi" (pp @tgi)
                                        ]
SEM TyExpr
  | Var         loc     .  info     :=  [ mkInfo1 "tgi" (pp @tgi)
                                        ]
SEM Decl
  | Data        loc     .  info     :=  [ mkInfo1 "dataKi" (ppTy @dataKi)
                                        , mkInfo1 "lhs.tyGam" (ppGam @lhs.tyGam)
                                        ]
%%]

%%[7
SEM Expr
  | Rec         loc     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","Rec"] [] [@recExpr.ppAST] @info
                        .  info     =   [ mkInfo1 "lhs.knTy" (pp @lhs.knTy)
                                        , mkInfo1 "lhs.knTy+subst" (pp (@recExpr.tyCnstr |=> @lhs.knTy))
                                        , mkInfo1 "recExpr.ty" (pp @recExpr.ty)
                                        , mkInfo1 "ty" (pp @ty)
                                        ]
  | Sel         loc     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","Sel"] [ppNm @lbl] [@expr.ppAST] @info
                        .  info     =   [ mkInfo1 "lhs.knTy" (pp @lhs.knTy)
                                        ]

SEM PatExpr
  | Rec         loc     .  ppAST    =   ppNest ["PatExpr","Rec"] [] [@recPatExpr.ppAST]

SEM TyExpr
  | Row         loc     .  ppAST    =   ppNest ["TyExpr","Row"] [] [@rowTyExpr.ppAST]

SEM RecExpr
  | Empty       loc     .  ppAST    =   ppNestInfo @lhs.opts ["RecExpr","Empty"] [] [] @info
                        .  info     =   [ mkInfo1 "lhs.knTy" (pp @lhs.knTy)
                                        , mkInfo1 "ty" (pp @ty)
                                        ]
  | Ext         loc     .  ppAST    =   ppNestInfo @lhs.opts ["RecExpr","Ext"] [ppNm @nm] [@recExpr.ppAST,@expr.ppAST] @info
                        .  info     =   [ mkInfo1 "lhs.knTy" (pp @lhs.knTy)
                                        , mkInfo1 "foTy foKnRec" (pp (foTy @foKnRec))
                                        , mkInfo1 "recTy" (pp @recTy)
                                        , mkInfo1 "ty" (pp @ty)
                                        ]
  | Upd         loc     .  ppAST    =   ppNestInfo @lhs.opts ["RecExpr","Upd"] [ppNm @nm] [@recExpr.ppAST,@expr.ppAST] @info
                        .  info     =   [ mkInfo1 "lhs.knTy" (pp @lhs.knTy)
                                        , mkInfo1 "foTy foKnRec" (pp (foTy @foKnRec))
                                        , mkInfo1 "recTy" (pp @recTy)
                                        , mkInfo1 "ty" (pp @ty)
                                        , mkInfo1 "finRecTy" (pp (@lhs.finTyCnstr |=> @recExpr.ty))
                                        ]
  | Expr        loc     .  ppAST    =   ppNestInfo @lhs.opts ["RecExpr","Expr"] [] [@expr.ppAST] @info
                        .  info     =   [ mkInfo1 "expr.ty" (pp @expr.ty)
                                        ]

SEM RecPatExpr
  | Empty       loc     .  ppAST    =   ppNest ["RecPatExpr","Empty"] [] []
  | Ext         loc     .  ppAST    =   ppNest ["RecPatExpr","Ext"] [ppNm @nm] [@recPatExpr.ppAST,@patExpr.ppAST]
  | Expr        loc     .  ppAST    =   ppNestInfo @lhs.opts ["RecPatExpr","Expr"] [] [@patExpr.ppAST] @info
                        .  info     =   []

SEM RowTyExpr
  | Empty       loc     .  ppAST    =   ppNest ["RowTyExpr","Empty"] [] []
  | Ext         loc     .  ppAST    =   ppNest ["RowTyExpr","Ext"] [ppNm @nm] [@rowTyExpr.ppAST,@tyExpr.ppAST]

SEM DataField
  | Field       loc     .  ppAST    =   ppNest ["DataField","Field"] [pp (maybe [] (map ppNm) @mbLabels)] [@tyExpr.ppAST]

SEM DataFields
  | Nil         lhs     .  ppAST    =   ppNest ["DataFields","Nil"] [] []
  | Cons        lhs     .  ppAST    =   ppNest ["DataFields","Cons"] [] [@hd.ppAST,@tl.ppAST]
%%]

%%[8
SEM Decl
  | FFI         loc     .  ppAST    =   ppNestInfo @lhs.opts ["Decl","FFI"] [pp (show @impEnt),ppNm @nm] [@tyExpr.ppAST] @info
                        .  info     =   []
%%]

%%[9
SEM RowTyExpr
  | Var         loc     .  ppAST    =   ppNest ["RowTyExpr","Var"] [ppNm @nm] []

SEM TyExpr
  | Pred        loc     .  ppAST    =   ppNest ["TyExpr","Pred"] [] [@prExpr.ppAST]

SEM PrExpr
  | Class       loc     .  ppAST    =   ppNest ["PrExpr","Class"] [ppNm @nm] [@tyExprs.ppAST]
  | Arrow       loc     .  ppAST    =   ppNest ["PrExpr","Arrow"] [] [@arg.ppAST,@res.ppAST]

SEM Decl
  | Class       loc     .  ppAST    =   ppNestInfo @lhs.opts ["Decl","Class"] [] [@tyPrExpr.ppAST,@funcDeps.ppAST,@decls.ppAST] @info
                        .  info     =   []
  | Instance    loc     .  ppAST    =   ppNestInfo @lhs.opts ["Decl","Instance"] (maybe [] (\(n,_) -> [ppNm n]) @mbNmElim) [@tyPrExpr.ppAST,@decls.ppAST] @info
                        .  info     =   [ mkInfo1 "tyPrExpr.ty" (ppTy @tyPrExpr.ty)
                                        , mkInfo1 "tyPrExpr.evTy" (ppTy @tyPrExpr.evTy)
                                        , mkInfo1 "supPrElimGam" (ppGam @supPrElimGam)
                                        , mkInfo1 "declsPrElimGam" (ppGam @declsPrElimGam)
                                        , mkInfo1 "supPrTyL" (ppCommaList @supPrTyL)
                                        , mkInfo1 "supPrUIDL" (ppCommaList @supPrUIDL)
                                        , mkInfo1 "prfCBindLMap" (ppCBindLMap @prfCBindLMap)
                                        , mkInfo1 "csubst" (ppAssocL . fmToList $ @csubst)
                                        , mkInfo1 "remPrfPrL" (ppCommaList @remPrfPrL)
                                        ]
  | InstanceIntro
                loc     .  ppAST    =   ppNestInfo @lhs.opts ["Decl","InstanceIntro"] [] [@expr.ppAST,@prExpr.ppAST] @info
                        .  info     =   []

SEM FuncDep
  | Dep         loc     .  ppAST    =   ppNest ["FuncDep","Dep"] [] [@fromTvs.ppAST,@toTvs.ppAST]

SEM FuncDeps
  | Nil         lhs     .  ppAST    =   ppNest ["FuncDeps","Nil"] [] []
  | Cons        lhs     .  ppAST    =   ppNest ["FuncDeps","Cons"] [] [@hd.ppAST,@tl.ppAST]


SEM Expr
  | Let         loc     .  info4    :=  [ mkInfo1 "prElimGam" (ppGam @prElimGam)
                                        , mkInfo1 "gathSubsPredL" (ppCommaList @gathSubsPredL)
                                        , mkInfo1 "prfCBindLMap" (ppCBindLMap @prfCBindLMap)
                                        , mkInfo1 "csubst" (ppAssocL . fmToList $ @csubst)
                                        , mkInfo1 "remPrfPrL" (ppCommaList @remPrfPrL)
                                        , mkInfo1 "tqoGam" (pp @tqoGam)
                                        ]
  | Lam         loc     .  info3    :=  [ mkInfo1 "imTy" (pp @imTy)
                                        , mkInfo1 "imTy+subst" (pp (@body.tyCnstr |=> @imTy))
                                        , mkInfo1 "knImpls" (pp @knImpls)
                                        , mkInfo1 "knPrL" (ppCommaList @knPrL)
                                        , mkInfo1 "gathSubsPredL" (ppCommaList @gathSubsPredL)
                                        , mkInfo1 "inKnGathPrL" (ppCommaList @inKnGathPrL)
                                        , mkInfo1 "remPrfPrL" (ppCommaList @remPrfPrL)
                                        , mkInfo1 "csubst" (ppAssocL . fmToList $ @csubst)
                                        , mkInfo1 "lamBodyCoeL" (ppCommaList @lamBodyCoeL)
                                        , mkInfo1 "lamArgCoeL" (ppCommaList @lamArgCoeL)
                                        ]
  | AppTop      loc     .  info9    :=  [ mkInfo1 "resTy" (pp @resTy)
                                        , mkInfo1 "ty" (pp @ty)
                                        , mkInfo1 "imTy" (pp @imTy)
                                        , mkInfo1 "imTy+subst" (pp (@expr.tyCnstr |=> @imTy))
                                        , mkInfo1 "gathSubsPredL" (ppCommaList @gathSubsPredL)
                                        , mkInfo1 "inKnGathPrL" (ppCommaList @inKnGathPrL)
                                        , mkInfo1 "remGathPrL" (ppCommaList @remGathPrL)
                                        , mkInfo1 "remPrfPrL" (ppCommaList @remPrfPrL)
                                        , mkInfo1 "csubst" (ppAssocL . fmToList $ @csubst)
                                        ]
  | AppImpl     lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","AppImpl"] [] [@func.ppAST,@arg.ppAST,@argPr.ppAST] @info
                loc     .  info     =   [ mkInfo1 "knTy" (ppTy @lhs.knTy)
                                        ]
  | LamImpl     lhs     .  ppAST    =   ppNestInfo @lhs.opts ["Expr","LamImpl"] [] [@arg.ppAST,@argPr.ppAST,@body.ppAST] @info
                loc     .  info     =   [ mkInfo1 "lhs.knTy" (pp @lhs.knTy)
                                        , mkInfo1 "funTy" (pp @funTy)
                                        , mkInfo1 "ty" (pp @ty)
                                        , mkInfo1 "knPrL" (ppCommaList @knPrL)
                                        , mkInfo1 "gathSubsPredL" (ppCommaList @gathSubsPredL)
                                        , mkInfo1 "inKnGathPrL" (ppCommaList @inKnGathPrL)
                                        , mkInfo1 "remPrfPrL" (ppCommaList @remPrfPrL)
                                        , mkInfo1 "prfCBindLMap" (ppCBindLMap @prfCBindLMap)
                                        , mkInfo1 "lamBodyCoeL" (ppCommaList @lamBodyCoeL)
                                        , mkInfo1 "lamArgCoeL" (ppCommaList @lamArgCoeL)
                                        ]
%%]
  | Instance    loc     .  ppAST    =   ppNestInfo @lhs.opts ["Decl","Instance"] (maybe [] (\(n,_) -> [ppNm n]) @mbNmElim) [@ctxtPrExprs.ppAST,@prExpr.ppAST,@decls.ppAST] @info

%%[10
SEM PrExpr
  | Lacks       loc     .  ppAST    =   ppNest ["PrExpr","Lacks"] [ppNm @nm] [@rowTyExpr.ppAST]
%%]

%%[11
SEM DataConstrEq
  | Eq          lhs     .  ppAST    =   ppNest ["DataConstrEq","Eq"] [] [@tyVar.ppAST,@tyExpr.ppAST]

SEM DataConstrEqs
  | Nil         lhs     .  ppAST    =   ppNest ["DataConstrEqs","Nil"] [] []
  | Cons        lhs     .  ppAST    =   ppNest ["DataConstrEqs","Cons"] [] [@hd.ppAST,@tl.ppAST]

SEM DataConstr
  | Constr      loc     .  ppAST    :=  ppNestInfo @lhs.opts  ["DataConstr","Constr"] [ppNm @conNm] [@fields.ppAST,@eqs.ppAST] @info
                loc     .  info     =   [ mkInfo1 "eqs.eqTyCnstr" (pp @eqs.eqTyCnstr)
                                        ]
%%]


